// NOTE: This test file is mostly commented out (out of date).
// Keep the suite runnable by providing Unity's required hooks.

#include "unity.h"
// #include "matrixhelper.h"
// #include "kalman_filter_config.h"
// #include "unscented_kalman_filter.h"
// #include "ukf_functions.h"
// #include <string.h>
// #include <stdlib.h>

// static UKF ukf;
// static double dt;
// static double measurements[10];

void setUp(void) {
    
}

void tearDown(void) {}
// void setUp(void) {
//     ukf_init(&ukf);
//     // using a real update step from a flight
//     double ukf_X[22] = {
//         9.565670752618082, -36.651745701260566, 40.216766577268075, 32.419816061120187, -114.406708688660501, 126.848197943094519, 7.085873760257990, -19.179188978070922, 20.659069703034930, 39.428053064236749, 1.457899096362111, 2.531616425992384, 0.000078891093802, -0.000052811331349, 0.000028853845459, 0.000077591281369, 0.000189405552908, 0.000087355771394, -0.761485339096257, 0.066075229080381, 0.371006220997967, 0.527378921103453
//     };
//     double ukf_P[21 * 21] = {
//         0.500286844160090, 0.141278824242253, 0.096301246225614, 1.383785782940953, 0.451232440721061, 0.387908175284812, 0.100404415835860, 0.055510105626500, 0.072276718031056, 0.000002232920723, 0.000000260045144, 0.000000856411949, -0.000119039247091, -0.000045020105404, -0.000320535235537, -0.000000045215942, 0.000000033705686, 0.000000037868786, -0.000478904065095, -0.003264416358650, 0.007983199880172,
//         0.141278824242263, 0.501880335218093, -0.125280062692807, 0.421254189185057, 1.562062145068346, -0.600554315069152, 0.021770298191736, 0.233744374023548, -0.130975564485332, 0.000002464195241, 0.000000357388217, 0.000000231387921, 0.000334463614093, -0.000041882556548, -0.000121663596771, -0.000000032298076, 0.000000022780958, 0.000000039594889, -0.000564767854455, -0.003696509700293, 0.008776426715214,
//         0.096301246225601, -0.125280062692817, 0.471750176761415, 0.358430433152351, -0.607129256148715, 1.555424060172623, 0.086742240253459, -0.171016087975370, 0.228392085665928, -0.000001007830370, -0.000000156281483, 0.000000619175707, -0.000058100596009, 0.000396858903712, -0.000095252372046, -0.000000014108357, 0.000000011936494, 0.000000030171410, 0.000261074212970, 0.001683348647141, -0.003760020294964,
//         1.383785782940969, 0.421254189184967, 0.358430433152488, 4.900237058039835, 1.741382134815584, 1.860325309103488, 0.918962789060919, 0.411764727213736, 0.602213793875103, 0.000025065555641, 0.000002824188447, 0.000007812618662, -0.000215279111876, -0.000032506601903, -0.000487118608816, -0.000000155765846, 0.000000105461862, 0.000000129041878, -0.005334886338115, -0.037027121011090, 0.090578104873646,
//         0.451232440721129, 1.562062145068344, -0.607129256148641, 1.741382134816213, 6.739424946864305, -3.284269664811029, 0.238444948276025, 2.048420187310836, -1.000788359326525, 0.000017946536062, 0.000002874341190, 0.000001876111390, 0.000568892247663, -0.000238615702000, -0.000154746179585, -0.000000122894206, 0.000000075583695, 0.000000127788178, -0.004087503179838, -0.026432399414021, 0.062992246681582,
//         0.387908175284699, -0.600554315069235, 1.555424060172617, 1.860325309102298, -3.284269664811640, 7.057586339007904, 0.752787014267989, -1.254191418989411, 1.896845368274419, -0.000009810654687, -0.000001273243247, 0.000004974591489, -0.000140308767410, 0.000789724104589, -0.000317325752133, -0.000000050397242, 0.000000040090156, 0.000000103396178, 0.002521018312266, 0.016526923617809, -0.037090179826475,
//         0.100404415835898, 0.021770298191643, 0.086742240253624, 0.918962789061116, 0.238444948275375, 0.752787014269410, 0.877305383353334, 0.195046150370376, 0.508076231435047, 0.000031453045062, 0.000003492263625, 0.000008721646786, -0.000006306367028, 0.000025508175678, 0.000006883877759, -0.000000026748960, 0.000000017669326, 0.000000026135170, -0.006827250877196, -0.047028531509068, 0.114165394344840,
//         0.055510105626529, 0.233744374023549, -0.171016087975342, 0.411764727214003, 2.048420187310851, -1.254191418989178, 0.195046150370657, 1.616623386724394, -0.626814634733618, 0.000007028453685, 0.000001554514593, 0.000000817281025, 0.000017013260767, -0.000070841520554, 0.000018231993236, -0.000000027070818, 0.000000015473362, 0.000000020779674, -0.001612066474801, -0.009707688171312, 0.023173367422085,
//         0.072276718030963, -0.130975564485381, 0.228392085665898, 0.602213793874155, -1.000788359326899, 1.896845368274207, 0.508076231433950, -0.626814634733756, 1.299087026609325, -0.000012346708055, -0.000001346018621, 0.000002576524583, -0.000019901975583, 0.000074369615761, -0.000091935379269, -0.000000011279748, 0.000000009323845, 0.000000017280915, 0.002982501687926, 0.020143628643705, -0.046476273774125,
//         0.000002232920724, 0.000002464195241, -0.000001007830369, 0.000025065555652, 0.000017946536059, -0.000009810654672, 0.000031453045073, 0.000007028453684, -0.000012346708045, 0.030441489992036, -0.000000002094118, -0.000000003365708, 0.000000000356787, -0.000000000193202, -0.000000003949626, -0.000001228579046, 0.000001228578961, 0.000000000000702, -0.001100747799413, -0.000478042886133, 0.000102254246234,
//         0.000000260045145, 0.000000357388216, -0.000000156281481, 0.000002824188462, 0.000002874341188, -0.000001273243227, 0.000003492263639, 0.000001554514591, -0.000001346018608, -0.000000002094119, 0.030441484848545, -0.000000008570268, -0.000000000014224, -0.000000000048587, -0.000000000315897, -0.000001228578505, -0.000001228578129, 0.000000000000452, 0.010765844365521, -0.006687841938994, -0.009094714457961,
//         0.000000856411949, 0.000000231387921, 0.000000619175706, 0.000007812618658, 0.000001876111392, 0.000004974591481, 0.000008721646782, 0.000000817281026, 0.000002576524578, -0.000000003365708, -0.000000008570268, 0.030441485254620, 0.000000000308934, 0.000000000194492, -0.000000000920325, 0.000000000001332, -0.000000000000668, -0.000001737471359, 0.010894503603713, 0.011399448843180, 0.004624462678112,
//         -0.000119039247091, 0.000334463614093, -0.000058100596009, -0.000215279111876, 0.000568892247663, -0.000140308767410, -0.000006306367028, 0.000017013260767, -0.000019901975583, 0.000000000356787, -0.000000000014224, 0.000000000308934, 0.000098376613313, -0.000000313032487, -0.000000108075026, -0.000000000003934, 0.000000000002772, 0.000000000001474, -0.000000063039246, -0.000000543850334, 0.000001402837710,
//         -0.000045020105404, -0.000041882556548, 0.000396858903712, -0.000032506601903, -0.000238615702000, 0.000789724104589, 0.000025508175678, -0.000070841520554, 0.000074369615761, -0.000000000193202, -0.000000000048587, 0.000000000194492, -0.000000313032487, 0.000098822810235, 0.000000056455149, -0.000000000002949, 0.000000000002460, 0.000000000000330, 0.000000056084349, 0.000000320485533, -0.000000678613320,
//         -0.000320535235537, -0.000121663596771, -0.000095252372046, -0.000487118608816, -0.000154746179585, -0.000317325752133, 0.000006883877759, 0.000018231993236, -0.000091935379269, -0.000000003949626, -0.000000000315897, -0.000000000920325, -0.000000108075026, 0.000000056455149, 0.000098218314839, 0.000000000004313, 0.000000000000163, -0.000000000002400, 0.000000880715900, 0.000006162716079, -0.000014758655206,
//         -0.000000045215942, -0.000000032298076, -0.000000014108357, -0.000000155765846, -0.000000122894206, -0.000000050397242, -0.000000026748960, -0.000000027070818, -0.000000011279748, -0.000001228579046, -0.000001228578505, 0.000000000001332, -0.000000000003934, -0.000000000002949, 0.000000000004313, 0.000099549929645, -0.000000000000006, -0.000000000000011, -0.000000000088411, 0.000000001510819, -0.000000003622822,
//         0.000000033705686, 0.000000022780958, 0.000000011936494, 0.000000105461862, 0.000000075583695, 0.000000040090156, 0.000000017669326, 0.000000015473362, 0.000000009323845, 0.000001228578961, -0.000001228578129, -0.000000000000668, 0.000000000002772, 0.000000000002460, 0.000000000000163, -0.000000000000006, 0.000099549929640, 0.000000000000007, -0.000000000416680, -0.000000000708245, 0.000000003022714,
//         0.000000037868786, 0.000000039594889, 0.000000030171410, 0.000000129041878, 0.000000127788178, 0.000000103396178, 0.000000026135170, 0.000000020779674, 0.000000017280915, 0.000000000000702, 0.000000000000452, -0.000001737471359, 0.000000000001474, 0.000000000000330, -0.000000000002400, -0.000000000000011, 0.000000000000007, 0.000099549929643, -0.000000000605738, -0.000000001376165, 0.000000001615401,
//         -0.000478904065081, -0.000564767854499, 0.000261074213044, -0.005334886338059, -0.004087503180147, 0.002521018312906, -0.006827250877234, -0.001612066474934, 0.002982501688425, -0.001100747799419, 0.010765844365515, 0.010894503603716, -0.000000063039246, 0.000000056084349, 0.000000880715900, -0.000000000088411, -0.000000000416680, -0.000000000605738, -0.012665446998232, -0.040075097869816, -0.006027626417415,
//         -0.003264416358614, -0.003696509700459, 0.001683348647401, -0.037027121011037, -0.026432399415185, 0.016526923620065, -0.047028531509377, -0.009707688171808, 0.020143628645492, -0.000478042886150, -0.006687841939021, 0.011399448843188, -0.000000543850334, 0.000000320485533, 0.000006162716079, 0.000000001510819, -0.000000000708245, -0.000000001376165, -0.040075097869896, 0.084883439202902, -0.105354881285045,
//         0.007983199880112, 0.008776426715518, -0.003760020295434, 0.090578104873596, 0.062992246683713, -0.037090179830556, 0.114165394345454, 0.023173367422992, -0.046476273777367, 0.000102254246267, -0.009094714457907, 0.004624462678096, 0.000001402837710, -0.000000678613320, -0.000014758655206, -0.000000003622822, 0.000000003022714, 0.000000001615401, -0.006027626417224, -0.105354881284960, 0.232768332019334,
//     };
//     double ukf_Q_diag[21] = {0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 10.0, 10.0, 10.0, 10000.0, 10000.0, 10000.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 100.0, 100.0, 100.0};
//     double ukf_R_diag[10] = {126848.197943094521179, 10.0, 10.0, 0.01, 100.0, 100.0, 100.0, 0.001, 0.001, 0.001};
//     for (int i = 0; i < 21; i++) {
//         ukf.Q[21 * i + i] = ukf_Q_diag[i];
//     }
//     for (int i = 0; i < 10; i++) {
//         ukf.R[10 * i + i] = ukf_R_diag[i];
//     }
//     memcpy(ukf.P, ukf_P, sizeof(ukf_P));
//     memcpy(ukf.X, ukf_X, sizeof(ukf_X));
//     ukf.flight_state = 1;
//     ukf.initial_pressure = 100970.359375;
//     ukf.mag_world[0] = 0.08531356;
//     ukf.mag_world[1] = 0.41851669;
//     ukf.mag_world[2] = -0.90419322;
//     ukf.measurement_function = ukf_measurement_function;
//     ukf.state_transition_function = ukf_state_transition_function;
//     dt = 0.0045865476190556365;
//     double measurements_cpy[10] = {99729.375000000000000, 19.289408007812501, -19.691504882812499, 1.045701171875000, 1681.258622089631444, -1573.851593702687978, 149.886771783372041, -0.866744418481657, -0.083822853501634, 0.491658257595393};
//     memcpy(measurements, measurements_cpy, sizeof(measurements_cpy));
// }
// void tearDown(void) {}

// void test_ukf_verify_predict(void) {
//     int status = ukf_predict(&ukf, dt);
//     TEST_ASSERT_EQUAL(0, status);
//     double exp_next_x[22] = {
//         9.714365783, -37.176477518, 40.798561878, 32.738248096, -115.268602139, 127.722298698, 7.085873760, -19.179188978, 20.659069703, 39.428053064, 1.457899096, 2.531616426, 0.000078891, -0.000052811, 0.000028854, 0.000077591, 0.000189406, 0.000087356, -0.768098863, 0.004717868, 0.410131708, 0.491725392
//     };
//     TEST_ASSERT_DOUBLE_ARRAY_WITHIN(1e-6, exp_next_x, ukf.X, 22);
//     // test a few P values
//     TEST_ASSERT_DOUBLE_WITHIN(1e-7, 0.513129392817444, ukf.P[0]);
//     TEST_ASSERT_DOUBLE_WITHIN(1e-7, 0.371016173317179, ukf.P[21*2 +3]);
//     TEST_ASSERT_DOUBLE_WITHIN(1e-7, -0.046589342458395, ukf.P[21*18 + 19]);
// }

// void test_ukf_verify_sigmas_h(void) {
//     int status = ukf_predict(&ukf, dt);
//     TEST_ASSERT_EQUAL(0, status);
//     ukf_update(&ukf, measurements);
//     TEST_ASSERT_EQUAL(0, status);
//     double *sigmas_h = ukf_test_get_sigmas_h();
//     double exp_sigmas_h[43*10] = {
//         100482.903149496210972, 19.288200000000000, -17.780269352688777, 1.372135545347748, 1656.463120022552857, -1538.331522086823043, 145.051023911128510, -0.872478097043469, -0.085386294190479, 0.481135273019787,
//         100482.827378716814565, 19.288200000000000, -17.787866881418633, 1.369302120885312, 1656.463126563034166, -1538.331527262942927, 145.051027092545439, -0.872579784667672, -0.084891865062885, 0.481038346325388,
//         100483.028343480953481, 19.288200000000000, -17.776369968677312, 1.368704346322564, 1656.463125805310028, -1538.331526318806254, 145.051023872761903, -0.872568099843819, -0.084963537291220, 0.481046888011876,
//         100482.551354934781557, 19.288200000000000, -17.781791347627134, 1.375365844146259, 1656.463117257436807, -1538.331519980667736, 145.051025778493198, -0.872429498652255, -0.085605350592480, 0.481184469648922,
//         100482.901878695818596, 19.288200000000000, -17.836467862704307, 1.351071617403380, 1656.463158329567932, -1538.331552713694919, 145.051037601462184, -0.873081070700193, -0.082436560180338, 0.480555571740291,
//         100482.905101268566796, 19.288200000000000, -17.743029119881506, 1.373300291451333, 1656.463123449909290, -1538.331523204983569, 145.051021945234879, -0.872510931273695, -0.085245086413517, 0.481100769122501,
//         100482.900711219466757, 19.288200000000000, -17.719676779112895, 1.400278242120401, 1656.463089749693836, -1538.331496602356538, 145.051023029383742, -0.871946104549621, -0.087879223816478, 0.481650529722698,
//         100482.903149496210972, 19.288200000000000, -17.887912400834303, 1.328505535898156, 1656.463182787272899, -1538.331572396085676, 145.051043489054820, -0.873479097075826, -0.080520302729134, 0.480157003302053,
//         100482.903149496210972, 19.288200000000000, -17.717622478627003, 1.388726859410182, 1656.463106758622644, -1538.331510157802541, 145.051020886092658, -0.872235939877753, -0.086533885873433, 0.481369246817054,
//         100482.903149496210972, 19.288200000000000, -17.674052571422962, 1.421570197364321, 1656.463065937987949, -1538.331477853844945, 145.051017373350788, -0.871555069916262, -0.089701925624655, 0.482022120490842,
//         100482.903149496210972, 19.288200000000000, -17.779055227433627, 1.366639371464691, 1669.040909187122452, -1550.909311252669568, 145.051023909667293, -0.872483897178485, -0.086062094923529, 0.481004329483235,
//         100482.903149496210972, 19.288200000000000, -17.774716338808300, 1.411001548328530, 1669.040909187363013, -1525.753732922012887, 145.051023907790267, -0.871807659899514, -0.085582533910355, 0.482314248213773,
//         100482.903149496210972, 19.288200000000000, -17.812884903088467, 1.377901112592746, 1656.463120022552857, -1538.331522086823043, 162.838703932737900, -0.872499044631452, -0.084169301519718, 0.481311692979598,
//         100482.903149496210972, 19.288200000000000, -17.780170459964456, 1.372164017764950, 1656.463120022548537, -1538.331522086825544, 145.051023911065613, -0.872477221990780, -0.085390194211737, 0.481136167669542,
//         100482.903149496210972, 19.288200000000000, -17.779480213039879, 1.372222305212726, 1656.463120022563999, -1538.331522086836912, 145.051023911042250, -0.872475364143149, -0.085399299689986, 0.481137920533957,
//         100482.903149496210972, 19.288200000000000, -17.776592850972396, 1.373535820633889, 1656.463120022471912, -1538.331522086720497, 145.051023911247114, -0.872448116642145, -0.085529356214286, 0.481164226634883,
//         100482.903149496210972, 19.288200000000000, -17.780269198300456, 1.372135552619456, 1656.463577247718604, -1538.331522086823043, 145.051023911128482, -0.872478096339332, -0.085386300120974, 0.481135273244175,
//         100482.903149496210972, 19.288200000000000, -17.780269494760805, 1.372135540963573, 1656.463120022552857, -1538.331064861657296, 145.051023911128510, -0.872478097650263, -0.085386288752598, 0.481135272884493,
//         100482.903149496210972, 19.288200000000000, -17.780269379946553, 1.372135513112941, 1656.463120022552857, -1538.331522086823043, 145.051481136294143, -0.872478097705484, -0.085386292993818, 0.481135272031676,
//         100482.903149496210972, 19.288200000000000, -17.766135731537275, 1.169378809418829, 1656.463120022552857, -1538.331522086823043, 145.051023911128510, -0.874024365115742, -0.099608326780656, 0.475562393824389,
//         100482.903149496210972, 19.288200000000000, -17.467571072532813, 2.287845966002987, 1656.463120022552857, -1538.331522086823043, 145.051023911128510, -0.855621718642185, -0.095762802717202, 0.508665863021631,
//         100482.903149496210972, 19.288200000000000, -18.592314654149902, 1.563765359967276, 1656.463120022552857, -1538.331522086823043, 145.051023911128510, -0.871791769633170, -0.053720864085110, 0.486922148974366,
//         100482.978920321867918, 19.288200000000000, -17.772674102328310, 1.374968446181596, 1656.463113482072004, -1538.331516910702931, 145.051020729711581, -0.872376128096134, -0.085880671200851, 0.481232169999149,
//         100482.777955637822743, 19.288200000000000, -17.784155042885516, 1.375569996316208, 1656.463114239795914, -1538.331517854839603, 145.051023949495089, -0.872387888027850, -0.085809012082738, 0.481223634361087,
//         100483.254945054955897, 19.288200000000000, -17.778739742200329, 1.368906584600002, 1656.463122787669136, -1538.331524192977895, 145.051022043763794, -0.872526639718510, -0.085167226943119, 0.481086069676046,
//         100482.904420296632452, 19.288200000000000, -17.724055582172166, 1.393176238272573, 1656.463081715538237, -1538.331491459950712, 145.051010220794808, -0.871865107595503, -0.088334168580281, 0.481713928404311,
//         100482.901197723869700, 19.288200000000000, -17.817501307569540, 1.370974989127486, 1656.463116595196652, -1538.331520968662289, 145.051025877022113, -0.872445239949183, -0.085527497607643, 0.481169772993887,
//         100482.905587772998842, 19.288200000000000, -17.840589510883799, 1.343988306049137, 1656.463150295411879, -1538.331547571289093, 145.051024792873221, -0.873002900584973, -0.082892002252897, 0.480619237580779,
//         100482.903149496210972, 19.288200000000000, -17.672355813738577, 1.415690285751655, 1656.463057257833270, -1538.331471777560182, 145.051004333202172, -0.871449829042847, -0.090247185775208, 0.482110610670257,
//         100482.903149496210972, 19.288200000000000, -17.842910458821812, 1.355519915865485, 1656.463133286483298, -1538.331534015843545, 145.051026936164362, -0.872718731383597, -0.084238414926767, 0.480901138845430,
//         100482.903149496210972, 19.288200000000000, -17.885798605962442, 1.322669807922501, 1656.463174107117993, -1538.331566319800686, 145.051030448906232, -0.873379592818825, -0.081066596672152, 0.480246076248020,
//         100482.903149496210972, 19.288200000000000, -17.781489126024073, 1.377629349915156, 1643.885330857983490, -1525.753732920976290, 145.051023912589727, -0.872472298428598, -0.084710301666772, 0.481265262891728,
//         100482.903149496210972, 19.288200000000000, -17.785784730657706, 1.333265416932715, 1643.885330857742929, -1550.909311251632971, 145.051023914466754, -0.873146899948718, -0.085190003914747, 0.479955367032132,
//         100482.903149496210972, 19.288200000000000, -17.747616088053206, 1.366370289458888, 1656.463120022552857, -1538.331522086823043, 127.263343889519120, -0.872455418524242, -0.086603342568673, 0.480958837889089,
//         100482.903149496210972, 19.288200000000000, -17.780368245056810, 1.372107072879055, 1656.463120022557177, -1538.331522086820314, 145.051023911191407, -0.872478972078358, -0.085382394165677, 0.481134378368070,
//         100482.903149496210972, 19.288200000000000, -17.781058488424776, 1.372048784940892, 1656.463120022541943, -1538.331522086809173, 145.051023911214770, -0.872480829747927, -0.085373288653864, 0.481132625485731,
//         100482.903149496210972, 19.288200000000000, -17.783945382789728, 1.370735201476094, 1656.463120022633802, -1538.331522086925361, 145.051023911009906, -0.872508053809714, -0.085243227721835, 0.481106316903811,
//         100482.903149496210972, 19.288200000000000, -17.780269507077097, 1.372135538076029, 1656.462662797387338, -1538.331522086823043, 145.051023911128539, -0.872478097747606, -0.085386288259983, 0.481135272795398,
//         100482.903149496210972, 19.288200000000000, -17.780269210616744, 1.372135549731923, 1656.463120022552857, -1538.331979311988562, 145.051023911128482, -0.872478096436675, -0.085386299628360, 0.481135273155080,
//         100482.903149496210972, 19.288200000000000, -17.780269325430996, 1.372135577582547, 1656.463120022552857, -1538.331522086823043, 145.050566685962878, -0.872478096381454, -0.085386295387140, 0.481135274007898,
//         100482.903149496210972, 19.288200000000000, -17.798337124194926, 1.573994488338283, 1656.463120022552857, -1538.331522086823043, 145.051023911128510, -0.870921547328010, -0.070999963810546, 0.486266041934543,
//         100482.903149496210972, 19.288200000000000, -18.069890440112609, 0.453507631218141, 1656.463120022552857, -1538.331522086823043, 145.051023911128510, -0.888324564087571, -0.074829760497035, 0.453078332943195,
//         100482.903149496210972, 19.288200000000000, -16.943833192782549, 1.181106639980046, 1656.463120022552857, -1538.331522086823043, 145.051023911128510, -0.871979974576661, -0.117053936419235, 0.475341245744622,
//     };

//     TEST_ASSERT_DOUBLE_ARRAY_WITHIN(1e-7, exp_sigmas_h, sigmas_h, 43 * 10);
// }

// void test_ukf_update_unscented_transform_h(void) {
//     int status = ukf_predict(&ukf, dt);
//     TEST_ASSERT_EQUAL(0, status);
//     status = ukf_update(&ukf, measurements);
//     TEST_ASSERT_EQUAL(0, status);
//     double *pred_z = ukf_test_get_pred_z();
//     double *s = ukf_test_get_S();
//     double exp_pred_z[10] = {100482.903428018093109, 19.288199999995413, -7.093876423129132, 0.569559139517310, 1656.463120023254305, -1538.331522085121833, 145.051023910818913, -0.330543958011333, -0.000842541695842, 0.246648553153108};
//     double exp_S[10*10] = {
//         126917.334072928788373, -0.000000000000004, 0.766131847664019, -0.662765537011867, 0.000587126221930, -0.000430454593991, -0.000438988672871, -0.009808377207533, 0.045350010285911, -0.010424783988688,
//         -0.000000000000004, 10.000000000000000, -0.000000000147036, 0.000000000011043, 0.000000000000000, 0.000000000000000, 0.000000000000000, -0.000000000007457, -0.000000000001163, 0.000000000003226,
//         0.766131847664159, -0.000000000147036, 622.554026171826081, 44.358999077898204, 40.427276611542723, 25.864528829303360, -276.425863592720702, 14.022882081972959, -12.903039384106611, -3.208403646146519,
//         -0.662765537011872, 0.000000000011043, 44.358999077905331, 442.346500192661210, 199.881993859112555, 265.711965120062416, 48.834167086473791, 6.499698493333598, -0.718786462303905, 13.637352048757544,
//         0.000587126221930, 0.000000000000000, 40.427276611534289, 199.881993859112526, 150767.409886453009676, -0.000008444399918, -0.000027706794033, 3.975828203432877, -5.223388496275812, 6.282676546859941,
//         -0.000430454593991, 0.000000000000000, 25.864528829308778, 265.711965120062416, -0.000008444408011, 150767.409900203172583, -0.000012081429951, 4.045433435804621, 2.872427308963251, 7.845648045477232,
//         -0.000438988672871, 0.000000000000000, -276.425863592717064, 48.834167086474046, -0.000027706794033, -0.000012081429951, 150767.409886219014879, -0.184780539961162, 10.308639060157837, 1.494382167353084,
//         -0.009808377207541, -0.000000000007457, 14.022882081985987, 6.499698493333561, 3.975828203432557, 4.045433435805018, -0.184780539960982, 0.718561272955087, 0.016177932689009, -0.032011248108310,
//         0.045350010285909, -0.000000000001163, -12.903039384106611, -0.718786462303903, -5.223388496275816, 2.872427308963253, 10.308639060157846, 0.016177932688959, 0.671464287651241, -0.060079984516448,
//         -0.010424783988687, 0.000000000003226, -3.208403646146612, 13.637352048757524, 6.282676546859886, 7.845648045477389, 1.494382167353014, -0.032011248108087, -0.060079984516476, 0.510316166604675,
//     };
//     TEST_ASSERT_DOUBLE_ARRAY_WITHIN(1e-7, exp_pred_z, pred_z, 10);
//     TEST_ASSERT_DOUBLE_ARRAY_WITHIN(1e-5, exp_S, s, 10 * 10);
// }

// void test_ukf_update_x_and_P(void) {
//     int status = ukf_predict(&ukf, dt);
//     TEST_ASSERT_EQUAL(0, status);
//     status = ukf_update(&ukf, measurements);
//     TEST_ASSERT_EQUAL(0, status);

//     double exp_x[22] = {9.719139395931109, -37.184055925274990, 40.822220773710988, 32.779314943842138, -115.329459819460041, 127.723697796805382, 7.169058576391072, -19.254512169669812, 20.547383460044127, 40.171985511035395, 1.325644433769025, 2.615975136063395, 0.000078891093802, -0.000052811331349, 0.000028853845459, 0.000077591281369, 0.000189405552908, 0.000087355771394, -0.790000718805788, -0.052514215012383, 0.447677711598221, 0.415602921123219};
//     double exp_P[21*21] = {
//         0.512955871575637, 0.145011772436901, 0.099879558927374, 1.409393966334771, 0.459174342868087, 0.400850356344424, 0.103195813562573, 0.055510210888437, 0.075783601137835, 0.000002081396127, 0.000000894075515, -0.000000806769194, -0.000120046198634, -0.000045241445053, -0.000322677314011, -0.000000045981461, 0.000000034192320, 0.000000038456085, -0.000141454304177, -0.002368543433779, 0.006519051327127,
//         0.145011772436902, 0.515076956455987, -0.129619696589213, 0.426469918611705, 1.593640444503120, -0.611476465117813, 0.017682881647797, 0.237170608468721, -0.127866143124710, 0.000005359238611, 0.000001687578376, 0.000000931409750, 0.000336952083771, -0.000043005745224, -0.000121880243164, -0.000000033007171, 0.000000023201864, 0.000000040045386, -0.000775985818501, -0.006928792786582, 0.017533313529362,
//         0.099879558927371, -0.129619696589219, 0.484529881241369, 0.374223262031821, -0.621310216453302, 1.584946211766342, 0.096610861531552, -0.173285048726645, 0.226164826309635, -0.000002934523561, -0.000000935074338, -0.000001169252262, -0.000058587206026, 0.000400285860733, -0.000097587873057, -0.000000014266519, 0.000000012073431, 0.000000030720865, 0.000099929407116, 0.003587826402153, -0.010010171243900,
//         1.409393966334776, 0.426469918611709, 0.374223262031831, 4.965194885455262, 1.743024215354996, 1.951117580886373, 0.933735476769089, 0.407710410498601, 0.651405286653048, 0.000016407477694, 0.000008785281676, -0.000011158181567, -0.000215967315260, -0.000031559916775, -0.000483364347422, -0.000000157281565, 0.000000106118441, 0.000000130495373, 0.001822953833604, -0.015266460202258, 0.051636200949963,
//         0.459174342868098, 1.593640444503103, -0.621310216453242, 1.743024215354922, 6.843962562245235, -3.317426201404706, 0.214772578952336, 2.069184667069901, -0.980783246341558, 0.000047516550602, 0.000013870317521, 0.000010349036949, 0.000568829060309, -0.000242431336550, -0.000151921146252, -0.000000125463353, 0.000000077030568, 0.000000127340179, -0.009017527996919, -0.063764093122460, 0.154926605126624,
//         0.400850356344398, -0.611476465117872, 1.584946211766355, 1.951117580886260, -3.317426201405303, 7.115900638623171, 0.835267261622707, -1.259551008180427, 1.858050591139737, -0.000019998347746, -0.000007303871707, -0.000007038451857, -0.000139972384932, 0.000792242228653, -0.000330439860898, -0.000000050503335, 0.000000040290120, 0.000000104612937, -0.001513178549207, 0.022237506926018, -0.069165443813296,
//         0.103195813562587, 0.017682881647837, 0.096610861531533, 0.933735476769172, 0.214772578952704, 0.835267261622600, 0.875190712620842, 0.190964239444869, 0.566785819386788, 0.000010234841925, 0.000008796139729, -0.000015536093840, -0.000007025439940, 0.000025806098460, 0.000014597868320, -0.000000026761033, 0.000000017272035, 0.000000026867073, 0.006844186599852, -0.002899679394907, 0.032680597164969,
//         0.055510210888437, 0.237170608468680, -0.173285048726580, 0.407710410498480, 2.069184667069658, -1.259551008179826, 0.190964239444542, 1.617581737133734, -0.620249135234843, 0.000037899804892, 0.000009261617237, 0.000011971510730, 0.000016707575841, -0.000071719343587, 0.000015966010613, -0.000000028262743, 0.000000016236318, 0.000000019389402, -0.010709623353347, -0.054706812271068, 0.122757381666512,
//         0.075783601137810, -0.127866143124780, 0.226164826309669, 0.651405286652900, -0.980783246342209, 1.858050591139937, 0.566785819386781, -0.620249135235418, 1.251707289213282, -0.000007672390160, -0.000005024619111, 0.000000179564879, -0.000018896196843, 0.000073926510897, -0.000101849322803, -0.000000011312880, 0.000000009450372, 0.000000017168715, -0.005691029695589, 0.003318207462942, -0.028559021483076,
//         0.000002081396127, 0.000005359238612, -0.000002934523563, 0.000016407477697, 0.000047516550606, -0.000019998347762, 0.000010234841934, 0.000037899804889, -0.000007672390177, 0.030441531540248, -0.000000003745949, 0.000000000021500, 0.000000000322249, 0.000000000737239, 0.000000000949599, -0.000001228578887, 0.000001228578863, 0.000000000000691, -0.001223907914016, -0.000241346768348, 0.000078010664049,
//         0.000000894075514, 0.000001687578375, -0.000000935074337, 0.000008785281674, 0.000013870317517, -0.000007303871697, 0.000008796139724, 0.000009261617237, -0.000005024619102, -0.000000003745941, 0.030441532805909, -0.000000005287215, 0.000000000142817, 0.000000000104537, -0.000000000699593, -0.000001228578432, -0.000001228578221, 0.000000000000594, 0.008494209703819, -0.008800984521068, -0.011029750759874,
//         -0.000000806769194, 0.000000931409751, -0.000001169252264, -0.000011158181564, 0.000010349036958, -0.000007038451872, -0.000015536093832, 0.000011971510732, 0.000000179564865, 0.000000000021500, -0.000000005287215, 0.030441538983503, -0.000000000085975, 0.000000000439474, 0.000000002833766, 0.000000000000626, -0.000000000000133, -0.000001737472481, 0.014626737886497, 0.007995100880747, 0.004730704928452,
//         -0.000120046198634, 0.000336952083771, -0.000058587206026, -0.000215967315260, 0.000568829060309, -0.000139972384932, -0.000007025439940, 0.000016707575841, -0.000018896196843, 0.000000000322249, 0.000000000142817, -0.000000000085975, 0.000098376596855, -0.000000313006356, -0.000000107977403, -0.000000000003941, 0.000000000002772, 0.000000000001476, 0.000000034337032, -0.000000332826250, 0.000001079535735,
//         -0.000045241445053, -0.000043005745224, 0.000400285860733, -0.000031559916775, -0.000242431336550, 0.000792242228653, 0.000025806098460, -0.000071719343587, 0.000073926510897, 0.000000000737239, 0.000000000104537, 0.000000000439474, -0.000000313006356, 0.000098822606225, 0.000000056381110, -0.000000000002968, 0.000000000002476, 0.000000000000277, -0.000000302832302, -0.000001195886196, 0.000002422648320,
//         -0.000322677314011, -0.000121880243164, -0.000097587873057, -0.000483364347422, -0.000151921146252, -0.000330439860898, 0.000014597868320, 0.000015966010613, -0.000101849322803, 0.000000000949599, -0.000000000699593, 0.000000002833766, -0.000000107977403, 0.000000056381110, 0.000098216860229, 0.000000000004234, 0.000000000000271, -0.000000000002588, -0.000001768236402, -0.000003157960163, 0.000003040233061,
//         -0.000000045981461, -0.000000033007171, -0.000000014266519, -0.000000157281565, -0.000000125463353, -0.000000050503335, -0.000000026761033, -0.000000028262743, -0.000000011312880, -0.000001228578887, -0.000001228578432, 0.000000000000626, -0.000000000003941, -0.000000000002968, 0.000000000004234, 0.000099549929645, -0.000000000000006, -0.000000000000011, -0.000000000124938, 0.000000001712764, -0.000000003537412,
//         0.000000034192320, 0.000000023201864, 0.000000012073431, 0.000000106118441, 0.000000077030568, 0.000000040290120, 0.000000017272035, 0.000000016236318, 0.000000009450372, 0.000001228578863, -0.000001228578221, -0.000000000000133, 0.000000000002772, 0.000000000002476, 0.000000000000271, -0.000000000000006, 0.000099549929640, 0.000000000000007, -0.000000000290890, -0.000000000666870, 0.000000002646213,
//         0.000000038456085, 0.000000040045386, 0.000000030720865, 0.000000130495373, 0.000000127340179, 0.000000104612937, 0.000000026867073, 0.000000019389402, 0.000000017168715, 0.000000000000691, 0.000000000000594, -0.000001737472481, 0.000000000001476, 0.000000000000277, -0.000000000002588, -0.000000000000011, 0.000000000000007, 0.000099549929643, -0.000000000620875, -0.000000000857192, 0.000000001332827,
//         -0.000141454304177, -0.000775985818493, 0.000099929407104, 0.001822953833627, -0.009017527996872, -0.001513178549321, 0.006844186599915, -0.010709623353347, -0.005691029695700, -0.001223907914016, 0.008494209703819, 0.014626737886497, 0.000000034337032, -0.000000302832302, -0.000001768236402, -0.000000000124938, -0.000000000290890, -0.000000000620875, -0.012935328594553, -0.018564875955354, 0.005434178063403,
//         -0.002368543433779, -0.006928792786635, 0.003587826402238, -0.015266460202415, -0.063764093122778, 0.022237506926796, -0.002899679395329, -0.054706812271069, 0.003318207463686, -0.000241346768347, -0.008800984521066, 0.007995100880745, -0.000000332826250, -0.000001195886196, -0.000003157960162, 0.000000001712764, -0.000000000666870, -0.000000000857192, -0.018564875955355, 0.083442231597588, -0.084492703881115,
//         0.006519051327127, 0.017533313529459, -0.010010171244053, 0.051636200950246, 0.154926605127197, -0.069165443814694, 0.032680597165730, 0.122757381666517, -0.028559021484413, 0.000078010664043, -0.011029750759869, 0.004730704928456, 0.000001079535735, 0.000002422648320, 0.000003040233061, -0.000000003537412, 0.000000002646213, 0.000000001332827, 0.005434178063398, -0.084492703881065, 0.150252485814101,
//     };

//     TEST_ASSERT_DOUBLE_ARRAY_WITHIN(1e-6, exp_x, ukf.X, 22);
//     TEST_ASSERT_DOUBLE_ARRAY_WITHIN(1e-6, exp_P, ukf.P, 21*21);
// }